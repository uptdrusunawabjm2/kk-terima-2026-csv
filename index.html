<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kertas Kerja Penerimaan 2026</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #1e1e1e;
  color: #ddd;
}
h2, h4 { text-align: center; margin: 8px 0; }
h4 { font-weight: normal; color: #bbb; }

.sticky-header {
  position: sticky;
  top: 0;
  background: #252525;
  padding: 10px;
  border-bottom: 2px solid #444;
  z-index: 100;
}
.summary {
  display: flex;
  gap: 12px;
  margin-bottom: 10px;
}
.card {
  flex: 1;
  background: #2e2e2e;
  padding: 10px;
  border-radius: 8px;
}
.card h3 { margin: 0; color: #ffcc00; font-size: 15px; }
.card p { margin: 4px 0 0; font-size: 18px; font-weight: bold; }
.card small { display:block; margin-top:4px; color:#aaa; }

.filter-bar {
  display: flex;
  gap: 8px;
  justify-content: center;
}
input, button {
  padding: 8px;
  border-radius: 5px;
  border: 1px solid #666;
  background: #2a2a2a;
  color: #eee;
}
button { cursor: pointer; }

table {
  width: 100%;
  border-collapse: collapse;
  background: #2a2a2a;
}
th, td {
  border: 1px solid #444;
  padding: 6px;
  text-align: center;
}
th {
  background: #333;
  color: #ffcc00;
  position: sticky;
  top: 0;
}
tfoot td {
  background: #333;
  color: #ffcc00;
  font-weight: bold;
  position: sticky;
  bottom: 0;
}
</style>
</head>

<body>

<h2>Kertas Kerja Penerimaan</h2>
<h4>PERIODE 2026</h4>

<div class="sticky-header">
  <div class="summary">
    <div class="card"><h3>Total 2025</h3><p id="summary2025">0</p></div>
    <div class="card"><h3>Total 2026</h3><p id="summary2026">0</p></div>
    <div class="card"><h3>Total Semua</h3><p id="summaryAll">0</p></div>

    <!-- CARD TAMBAHAN -->
    <div class="card">
      <h3 id="summaryMonthTitle">Total Semua (Bulan)</h3>
      <p id="summaryMonth">0</p>
      <small id="summaryMonthNote"></small>
    </div>
  </div>

  <div class="filter-bar">
    <input type="text" id="searchInput" placeholder="Cari data..." oninput="loadData()">
    <input type="date" id="dateFilter" onchange="loadData()">
    <button onclick="resetFilter()">Reset</button>
  </div>
</div>

<table>
<thead>
<tr>
  <th>No</th>
  <th>Tanggal</th>
  <th>No Ref IBB</th>
  <th>STS</th>
  <th>Nama</th>
  <th>Unit</th>
  <th>Periode 2025</th>
  <th>Jumlah 2025</th>
  <th>Periode 2026</th>
  <th>Jumlah 2026</th>
  <th>Total</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
<tfoot>
<tr>
  <td colspan="7">TOTAL</td>
  <td id="total2025">0</td>
  <td></td>
  <td id="total2026">0</td>
  <td id="totalAll">0</td>
</tr>
</tfoot>
</table>

<script>
/* ===== UTIL (TIDAK DIUBAH) ===== */
const bulanIndo = [
  'Januari','Februari','Maret','April','Mei','Juni',
  'Juli','Agustus','September','Oktober','November','Desember'
];

function formatTanggalIndo(ddmmyyyy) {
  const [d,m,y] = ddmmyyyy.split('/');
  return `${parseInt(d)} ${bulanIndo[m-1]} ${y}`;
}

function normalizeDate(ddmmyyyy) {
  const [d,m,y] = ddmmyyyy.split('/');
  return `${y}-${m.padStart(2,'0')}-${d.padStart(2,'0')}`;
}

function parseCSVLine(line) {
  return line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/)
             .map(v => v.replace(/^"|"$/g,'').trim());
}

/* ===== LOAD CSV (TIDAK DIUBAH) ===== */
async function loadCSV() {
  const res = await fetch(
    'https://docs.google.com/spreadsheets/d/e/2PACX-1vRH935f8T5XIyyzq2VV2DiWBrVFP4ywewdut3zpYu9NJ_Nj5DpC546wsWcB8f-YOq1lhHONJMm4i37Q/pub?gid=0&single=true&output=csv',
    { cache: 'no-store' }
  );
  return await res.text();
}

/* ===== MAIN ===== */
async function loadData() {
  const csv = await loadCSV();
  const rows = csv.trim().split('\n').slice(1);

  tbody.innerHTML = '';

  let t25=0, t26=0, tAll=0, tMonth=0, no=1;

  const search = searchInput.value.toLowerCase();
  const filterDate = dateFilter.value;

  /* === TANGGAL AKHIR PERHITUNGAN === */
  let endDate = filterDate ? new Date(filterDate) : new Date();

  const activeMonth =
    endDate.getFullYear() + '-' + String(endDate.getMonth()+1).padStart(2,'0');

  summaryMonthTitle.textContent =
    'Total Semua (' + bulanIndo[endDate.getMonth()] + ' ' + endDate.getFullYear() + ')';

  /* === TEKS KECIL: HANYA SAAT FILTER AKTIF === */
  if (filterDate) {
    summaryMonthNote.textContent =
      'Terhitung sampai tanggal ' +
      endDate.getDate() + ' ' +
      bulanIndo[endDate.getMonth()] + ' ' +
      endDate.getFullYear();
  } else {
    summaryMonthNote.textContent = '';
  }

  rows.forEach(r=>{
    if(!r.trim()) return;
    const p = parseCSVLine(r);

    const sheetDate = p[0];
    const normalized = normalizeDate(sheetDate);
    const rowDate = new Date(normalized);

    if (filterDate && normalized !== filterDate) return;
    if (search && !p.join(' ').toLowerCase().includes(search)) return;

    const j25 = parseInt(p[6]) || 0;
    const j26 = parseInt(p[8]) || 0;
    const total = j25 + j26;

    t25+=j25;
    t26+=j26;
    tAll+=total;

    /* === TOTAL AWAL BULAN â†’ TANGGAL FILTER === */
    if (
      normalized.slice(0,7) === activeMonth &&
      rowDate <= endDate
    ) {
      tMonth += total;
    }

    tbody.innerHTML += `
      <tr>
        <td>${no++}</td>
        <td>${formatTanggalIndo(sheetDate)}</td>
        <td>${p[1]}</td>
        <td>${p[2]}</td>
        <td>${p[3]}</td>
        <td>${p[4]}</td>
        <td>${p[5]}</td>
        <td>${j25.toLocaleString()}</td>
        <td>${p[7]}</td>
        <td>${j26.toLocaleString()}</td>
        <td>${total.toLocaleString()}</td>
      </tr>`;
  });

  total2025.textContent = summary2025.textContent = t25.toLocaleString();
  total2026.textContent = summary2026.textContent = t26.toLocaleString();
  totalAll.textContent  = summaryAll.textContent  = tAll.toLocaleString();
  summaryMonth.textContent = tMonth.toLocaleString();
}

function resetFilter(){
  searchInput.value='';
  dateFilter.value='';
  loadData();
}

window.onload = loadData;
</script>

</body>
</html>
